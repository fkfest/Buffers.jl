<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tensor contractions · Buffers.jl documentation</title><meta name="title" content="Tensor contractions · Buffers.jl documentation"/><meta property="og:title" content="Tensor contractions · Buffers.jl documentation"/><meta property="twitter:title" content="Tensor contractions · Buffers.jl documentation"/><meta name="description" content="Documentation for Buffers.jl documentation."/><meta property="og:description" content="Documentation for Buffers.jl documentation."/><meta property="twitter:description" content="Documentation for Buffers.jl documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Buffers.jl documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../guide/">Guide</a></li><li><a class="tocitem" href="../prealloc/">Preallocation</a></li><li class="is-active"><a class="tocitem" href>Tensor contractions</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Example-Use-Case"><span>Example Use Case</span></a></li><li><a class="tocitem" href="#Setting-Up-Buffers"><span>Setting Up Buffers</span></a></li><li><a class="tocitem" href="#Performing-Tensor-Contractions"><span>Performing Tensor Contractions</span></a></li></ul></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../buffers/">Buffers</a></li></ul></li><li><a class="tocitem" href="../release-notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Tensor contractions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tensor contractions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/fkfest/Buffers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/fkfest/Buffers.jl/blob/main/docs/src/tensor_contractions.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tensor-Contractions-Using-Buffers.jl"><a class="docs-heading-anchor" href="#Tensor-Contractions-Using-Buffers.jl">Tensor Contractions Using Buffers.jl</a><a id="Tensor-Contractions-Using-Buffers.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Tensor-Contractions-Using-Buffers.jl" title="Permalink"></a></h1><p>This guide demonstrates how to perform efficient tensor contractions using Buffers.jl with two separate buffers. By managing input and output tensors in different buffers, you can optimize memory usage and improve performance, especially in high-performance computing applications.</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>When performing tensor contractions, it&#39;s common to have intermediate tensors and output tensors. Allocating these tensors in separate buffers allows for better control over memory and can prevent memory fragmentation. As a simple rule of thumb, for each tensor contraction operation, <strong>allocate input tensors in one buffer and the output tensor in another buffer.</strong> This allows you to free memory efficiently after each operation.</p><h2 id="Example-Use-Case"><a class="docs-heading-anchor" href="#Example-Use-Case">Example Use Case</a><a id="Example-Use-Case-1"></a><a class="docs-heading-anchor-permalink" href="#Example-Use-Case" title="Permalink"></a></h2><p>In this example use case, we will perform tensor contraction operations using Buffers.jl. Consider the following tensor contraction operation:</p><p class="math-container">\[E_{ij}^{kl} = A_{ij}^{ab} B_{ab}^{cd} C_{cd}^{ef} D_{ef}^{kl}\]</p><p>where <code>A</code>, <code>B</code>, <code>C</code>, and <code>D</code> are input tensors and <code>E</code> is the output tensor. We will perform binary tensor contractions using the <code>@tensor</code> macro from the TensorOperations.jl package. We will allocate <code>A</code> and <code>B</code> in one buffer, <code>AB</code> and <code>C</code> in another buffer, <code>ABC</code> and <code>D</code> in the first buffer and so on.</p><h2 id="Setting-Up-Buffers"><a class="docs-heading-anchor" href="#Setting-Up-Buffers">Setting Up Buffers</a><a id="Setting-Up-Buffers-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Up-Buffers" title="Permalink"></a></h2><p>First, create two buffers (<code>buf1</code>) and (<code>buf2</code>) which will be used interchangeably for input and output tensors. The size of each buffer should be based on the memory requirements of your tensors (use <a href="../buffers/#Buffers.@print_buffer_usage-Tuple{Any, Any}"><code>@print_buffer_usage</code></a> to calculate the sizes or let the buffers grow automatically).</p><pre><code class="language-julia hljs">using Buffers

# Create buffers with appropriate sizes
buf1 = Buffer(100000)
buf2 = Buffer(50000)</code></pre><h2 id="Performing-Tensor-Contractions"><a class="docs-heading-anchor" href="#Performing-Tensor-Contractions">Performing Tensor Contractions</a><a id="Performing-Tensor-Contractions-1"></a><a class="docs-heading-anchor-permalink" href="#Performing-Tensor-Contractions" title="Permalink"></a></h2><p>Allocate tensors in the input buffer for your computations. The input tensors should be allocated in the buffer <code>buf1</code>, and the output tensor should be allocated in the buffer <code>buf2</code>.</p><pre><code class="language-julia hljs"># Allocate input tensors in the input buffer
A = alloc!(buf1, ni, nj, na, nb)   # ni*nj*na*nb tensor
B = alloc!(buf1, na, nb, nc, nd)   # na*nb*nc*nd tensor
AB = alloc!(buf2, ni, nj, nc, nd)  # ni*nj*nc*nd tensor

# Initialize tensors with random values or data
rand!(B)
rand!(C)</code></pre><p>Perform the tensor contraction using the allocated input tensors and drop the input tensors from the input buffer.</p><pre><code class="language-julia hljs"># Perform tensor contraction (example using @tensor macro from TensorOperations.jl)
using TensorOperations

@tensor AB[i, j, c, d] = A[i, j, a, b] * B[a, b, c, d]
drop!(buf1, A, B)</code></pre><p>Allocate the new input tensor <code>C</code> in the buffer <code>buf2</code> and the new output tensor <code>ABC</code> in the buffer <code>buf1</code> and perform the next tensor contraction, etc.</p><pre><code class="language-julia hljs"># Allocate new input tensor in the output buffer
C = alloc!(buf2, nc, nd, ne, nf)   # nc*nd*ne*nf tensor
ABC = alloc!(buf1, ni, nj, ne, nf) # ni*nj*ne*nf tensor
@tensor ABC[i, j, e, f] = AB[i, j, c, d] * C[c, d, e, f]
drop!(buf2, C, AB)
D = alloc!(buf1, ne, nf, nk, nl)   # ne*nf*nk*nl tensor
E = alloc!(buf2, ni, nj, nk, nl)   # ni*nj*nk*nl output tensor
@tensor E[i, j, k, l] = ABC[i, j, e, f] * D[e, f, k, l]
drop!(buf1, D, ABC)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../prealloc/">« Preallocation</a><a class="docs-footer-nextpage" href="../buffers/">Buffers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 12 December 2024 15:10">Thursday 12 December 2024</span>. Using Julia version 1.10.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
