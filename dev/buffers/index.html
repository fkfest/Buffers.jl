<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Buffers · Buffers.jl documentation</title><meta name="title" content="Buffers · Buffers.jl documentation"/><meta property="og:title" content="Buffers · Buffers.jl documentation"/><meta property="twitter:title" content="Buffers · Buffers.jl documentation"/><meta name="description" content="Documentation for Buffers.jl documentation."/><meta property="og:description" content="Documentation for Buffers.jl documentation."/><meta property="twitter:description" content="Documentation for Buffers.jl documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Buffers.jl documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../guide/">Guide</a></li><li><a class="tocitem" href="../prealloc/">Preallocation</a></li><li><a class="tocitem" href="../tensor_contractions/">Tensor contractions</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li class="is-active"><a class="tocitem" href>Buffers</a><ul class="internal"><li><a class="tocitem" href="#Exported-functions"><span>Exported functions</span></a></li><li><a class="tocitem" href="#Internal-functions"><span>Internal functions</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../release-notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Buffers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Buffers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/fkfest/Buffers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/fkfest/Buffers.jl/blob/main/docs/src/buffers.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Buffers"><a class="docs-heading-anchor" href="#Buffers">Buffers</a><a id="Buffers-1"></a><a class="docs-heading-anchor-permalink" href="#Buffers" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers" href="#Buffers"><code>Buffers</code></a> — <span class="docstring-category">Module</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Buffers module</code></pre><p>This module contains functions to handle buffers.</p><p>The <a href="#Buffers.Buffer"><code>Buffer</code></a> object is used to store data of type <code>T</code> with an offset, while the <a href="#Buffers.ThreadsBuffer"><code>ThreadsBuffer</code></a> object is used to store data of type <code>T</code> with an offset for each thread.</p><p>The buffers are used to store data in a contiguous memory block and to avoid memory allocation in loops. The buffers can be used with <a href="#Buffers.alloc!-Tuple{Any, Vararg{Any}}"><code>alloc!</code></a> to allocate tensors of given dimensions, <a href="#Buffers.drop!-Tuple{Any, Vararg{Any}}"><code>drop!</code></a> to drop tensors from the buffer, and <a href="#Buffers.reset!-Tuple{Any}"><code>reset!</code></a> to reset the buffer to the initial state.</p><p>Alternativelly, the buffers can be reshaped with <a href="#Buffers.reshape_buf!-Tuple{Any, Vararg{Any}}"><code>reshape_buf!</code></a> to use the same memory block for different tensors or to allocate tensors with a specific offset.</p><p>The size of the buffer can be extended if necessary, and the buffer can be set to be extendable (default) or not at construction with <a href="#Buffers.Buffer"><code>Buffer</code></a> or later with <a href="#Buffers.set_extendable!"><code>set_extendable!</code></a>.</p><p>In any case, the <code>::ThreadsBuffer</code> buffers should be released after use with <a href="#Buffers.release!-Tuple{ThreadsBuffer}"><code>Buffers.release!</code></a> or <a href="#Buffers.reset!-Tuple{Any}"><code>reset!</code></a>.</p><p>If some functions complain about tensors being aliases or if the tensors will be used in C,  the <a href="#Buffers.neuralyze-Tuple{AbstractArray}"><code>neuralyze</code></a> function can be used to wipe the memory about the origin of the tensor. Do not use this function if the size of the tensor might be changed in between, i.e., neuralyze the tensor only after all necessary allocations are done.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L1-L25">source</a></section></article><h2 id="Exported-functions"><a class="docs-heading-anchor" href="#Exported-functions">Exported functions</a><a id="Exported-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Exported-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.Buffer" href="#Buffers.Buffer"><code>Buffers.Buffer</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Buffer{T}</code></pre><p>Buffer object to store data of type <code>T</code> with an offset.</p><p>The buffer allocates an extra element at the beginning which is used to check  if the buffer can be extended and to ensure that pointers to the allocated  arrays will never point to the same memory as the buffer.</p><p>If the buffer is used with <a href="#Buffers.reshape_buf!-Tuple{Any, Vararg{Any}}"><code>reshape_buf!</code></a>, the offset is set to zero.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/buffer.jl#L2-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.ThreadsBuffer" href="#Buffers.ThreadsBuffer"><code>Buffers.ThreadsBuffer</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ThreadsBuffer{T}</code></pre><p>Buffer object to store data of type <code>T</code> for each thread.</p><p>By default, the buffer is created for <code>nthreads()</code> threads, i.e., each thread has its own buffer <a href="#Buffers.Buffer"><code>Buffer</code></a>.</p><p>Create the buffer with <code>ThreadsBuffer{T}(len, nbuf=Threads.nthreads())</code> and use it with <a href="#Buffers.alloc!-Tuple{Any, Vararg{Any}}"><code>alloc!</code></a>, <a href="#Buffers.drop!-Tuple{Any, Vararg{Any}}"><code>drop!</code></a>, <a href="#Buffers.reset!-Tuple{Any}"><code>reset!</code></a>, etc.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Always <a href="#Buffers.reset!-Tuple{Any}"><code>reset!</code></a> or <a href="#Buffers.release!-Tuple{ThreadsBuffer}"><code>Buffers.release!</code></a> the buffer after use!</p></div></div><p><strong>Example</strong></p><pre><code class="language-julia hljs">julia&gt; buf = Buffer(10000)
julia&gt; C = alloc!(buf, 10, 10, 20) # 10x10x20 destination tensor on a single thread
julia&gt; tbuf = ThreadsBuffer(1000) # 1000 elements buffer for nthreads() threads each
julia&gt; Threads.@threads for k = 1:20
          A = alloc!(tbuf, 10, 10) # 10x10 tensor
          B = alloc!(tbuf, 10, 10) # 10x10 tensor
          rand!(A)
          rand!(B)
          @tensor C[:,:,k][i,j] = A[i,l] * B[l,j]
          reset!(tbuf)
        end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/threadsbuffer.jl#L1-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.alloc!-Tuple{Any, Vararg{Any}}" href="#Buffers.alloc!-Tuple{Any, Vararg{Any}}"><code>Buffers.alloc!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">alloc!(buf, dims...; extend=true)</code></pre><p>Allocate tensor of given dimensions in buffer <code>buf</code>.</p><p>The tensor is allocated in the buffer starting at the current offset.   The offset is increased by the length of the tensor.   If <code>extend=true</code>, the buffer is extended if necessary.   For <code>ThreadsBuffer</code>, the tensor is allocated in the buffer of the current thread.</p><p>Return the allocated tensor.</p><pre><code class="language-julia hljs">julia&gt; buf = Buffer(100000)
julia&gt; A = alloc!(buf, 10, 10, 20) # 10x10x20 tensor
julia&gt; B = alloc!(buf, 10, 10, 10) # 10x10x10 tensor starting after A
julia&gt; C = alloc!(buf, 10, 20) # 10x20 tensor starting after B
julia&gt; rand!(B)
julia&gt; rand!(C)
julia&gt; An = neuralyze(A) # tensor without origin
julia&gt; @tensor An[i,j,k] = B[i,j,l] * C[l,k]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L52-L74">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.drop!-Tuple{Any, Vararg{Any}}" href="#Buffers.drop!-Tuple{Any, Vararg{Any}}"><code>Buffers.drop!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">drop!(buf, tensor...)</code></pre><p>Drop tensor(s) from buffer <code>buf</code>.</p><p>Only last tensors can be dropped.   For <code>ThreadsBuffer</code>, drop tensors from the buffer of the current thread.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L77-L84">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.isextendable-Tuple{Any}" href="#Buffers.isextendable-Tuple{Any}"><code>Buffers.isextendable</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">isextendable(buf)</code></pre><p>Check if buffer <code>buf</code> is extendable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L121-L125">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.nbuffers-Tuple{ThreadsBuffer}" href="#Buffers.nbuffers-Tuple{ThreadsBuffer}"><code>Buffers.nbuffers</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">nbuffers(buf::ThreadsBuffer)</code></pre><p>Return the number of buffers in <code>buf::ThreadsBuffer</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/threadsbuffer.jl#L44-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.neuralyze-Tuple{AbstractArray}" href="#Buffers.neuralyze-Tuple{AbstractArray}"><code>Buffers.neuralyze</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">neuralyze(tensor::AbstractArray)</code></pre><p>Wipe the memory about origin of <code>tensor</code>.</p><p><code>tensor</code> is a (contiguous!) array that is a (possibly reshaped) view of a larger array.   Return the same tensor pointing to the same memory,    but without the information about the origin.   To be used together with <a href="#Buffers.alloc!-Tuple{Any, Vararg{Any}}"><code>alloc!</code></a> or <a href="#Buffers.reshape_buf!-Tuple{Any, Vararg{Any}}"><code>reshape_buf!</code></a> to trick <code>Base.mightalias</code>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Note that this function is unsafe and should be used with caution! If too much memory is wiped, Julia might garbage-collect the original array and the tensor will point to invalid memory. Also don&#39;t use this function if the buffer-size might change in between.</p></div></div><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>One can use <code>GC.@preserve</code> to prevent the garbage collection of the original array  (however, this shouldn&#39;t be necessary).</p></div></div><p><strong>Example</strong></p><pre><code class="language-julia hljs">julia&gt; buf = Buffer(100000)
julia&gt; A = alloc(buf, 10, 10, 20) # 10x10x20 tensor
julia&gt; B = alloc(buf, 10, 10, 10) # 10x10x10 tensor starting after A
julia&gt; C = alloc(buf, 10, 20) # 10x20 tensor starting after B
julia&gt; rand!(B)
julia&gt; rand!(C)
julia&gt; An = neuralyze(A) # tensor without origin but pointing to the same memory
julia&gt; @tensor An[i,j,k] = B[i,j,l] * C[l,k]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L135-L166">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.pseudo_alloc!-Tuple{Any, Vararg{Any}}" href="#Buffers.pseudo_alloc!-Tuple{Any, Vararg{Any}}"><code>Buffers.pseudo_alloc!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">pseudo_alloc!(buf, dims...)</code></pre><p>Pseudo allocation function to calculate length for buffer.</p><p>The function is used in combination with <code>@print_buffer_usage</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/usage.jl#L164-L170">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.pseudo_drop!-Tuple{Any, Vararg{Any}}" href="#Buffers.pseudo_drop!-Tuple{Any, Vararg{Any}}"><code>Buffers.pseudo_drop!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">pseudo_drop!(buf, lens...)</code></pre><p>Pseudo drop function to calculate length for buffer.</p><p>The function is used in combination with <code>@print_buffer_usage</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/usage.jl#L178-L184">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.pseudo_reset!-Tuple{Any}" href="#Buffers.pseudo_reset!-Tuple{Any}"><code>Buffers.pseudo_reset!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">pseudo_reset!(buf)</code></pre><p>Pseudo reset function to calculate length for buffer.</p><p>The function is used in combination with <code>@print_buffer_usage</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/usage.jl#L190-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.repair!-Tuple{ThreadsBuffer}" href="#Buffers.repair!-Tuple{ThreadsBuffer}"><code>Buffers.repair!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">repair!(buf::ThreadsBuffer)</code></pre><p>Repair ThreadsBuffer <code>buf</code> by releasing all buffers and resetting the pool.</p><p>This function should be used after the threaded loop  if the buffers were not released properly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/threadsbuffer.jl#L121-L128">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.reset!-Tuple{Any}" href="#Buffers.reset!-Tuple{Any}"><code>Buffers.reset!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset!(buf)</code></pre><p>Reset buffer <code>buf</code> to the initial state.   For <code>ThreadsBuffer</code>, reset the buffer of the current thread and release it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L87-L92">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.reshape_buf!-Tuple{Any, Vararg{Any}}" href="#Buffers.reshape_buf!-Tuple{Any, Vararg{Any}}"><code>Buffers.reshape_buf!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reshape_buf!(buf, dims...; offset=0, extend=true)</code></pre><p>Reshape (part of) a buffer to given dimensions (without copying),   using <code>offset</code>.</p><p>For <code>ThreadsBuffer</code>, reshape the buffer of the current thread.   Call <a href="#Buffers.reset!-Tuple{Any}"><code>reset!(::ThreadsBuffer)</code></a> or <a href="#Buffers.release!-Tuple{ThreadsBuffer}"><code>release!</code></a> after use.</p><p>It can be used, e.g., for itermediates in tensor contractions.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Do not use this function together with <a href="#Buffers.alloc!-Tuple{Any, Vararg{Any}}"><code>alloc!</code></a> or <a href="#Buffers.drop!-Tuple{Any, Vararg{Any}}"><code>drop!</code></a> on the same buffer!</p></div></div><p><strong>Example</strong></p><pre><code class="language-julia hljs">julia&gt; buf = Buffer(100000)
julia&gt; A = reshape_buf!(buf, 10, 10, 20) # 10x10x20 tensor
julia&gt; B = reshape_buf!(buf, 10, 10, 10, offset=2000) # 10x10x10 tensor starting at 2001
julia&gt; B .= rand(10,10,10)
julia&gt; C = rand(10,20)
julia&gt; @tensor A[i,j,k] = B[i,j,l] * C[l,k]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L95-L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.set_extendable!" href="#Buffers.set_extendable!"><code>Buffers.set_extendable!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_extendable!(buf, extend=true)</code></pre><p>Set buffer <code>buf</code> to be extendable or not.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L128-L132">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.used" href="#Buffers.used"><code>Buffers.used</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">used(buf)</code></pre><p>Return the number of elements used in buffer <code>buf</code>.</p><p>If the buffer is used with <a href="#Buffers.reshape_buf!-Tuple{Any, Vararg{Any}}"><code>reshape_buf!</code></a>, <code>-1</code> is returned.</p><p>For <code>ThreadsBuffer</code>, return the number of elements used in the buffer of the current thread.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L41-L49">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.with_buffer-Tuple{Function, ThreadsBuffer}" href="#Buffers.with_buffer-Tuple{Function, ThreadsBuffer}"><code>Buffers.with_buffer</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">with_buffer(f::Function, buf::ThreadsBuffer)</code></pre><p>Execute function <code>f</code> with buffer <code>buf</code>.</p><p>The buffer is released after the function is executed.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">julia&gt; buf = Buffer(10000)
julia&gt; C = alloc!(buf, 10, 10, 20) # 10x10x20 destination tensor on a single thread
julia&gt; tbuf = ThreadsBuffer(1000)
julia&gt; Threads.@threads for k = 1:20
          with_buffer(tbuf) do bu
            A = alloc!(bu, 10, 10) # 10x10 tensor
            B = alloc!(bu, 10, 10) # 10x10 tensor
            rand!(A)
            rand!(B)
            @tensor C[:,:,k][i,j] = A[i,l] * B[l,j]
          end
        end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L185-L207">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.@print_buffer_usage-Tuple{Any, Any}" href="#Buffers.@print_buffer_usage-Tuple{Any, Any}"><code>Buffers.@print_buffer_usage</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@print_buffer_usage(buf, ex)</code></pre><p>Print buffer <code>buf</code> usage in expression <code>ex</code>.</p><p>The macro generates a body of a function that calculates the length of buffer <code>buf</code>  in expression <code>ex</code>. It is possible to use the macro with multiple buffers, e.g.,  <code>@print_buffer_usage buf1 buf2 begin ... end</code>.</p><p>All function calls with <code>buf</code> as an argument are replaced with <code>pseudo_&lt;function&gt;</code> calls. <code>pseudo_alloc!</code>,<code>pseudo_drop!</code>, and <code>pseudo_reset!</code> functions are pre-defined, custom <code>pseudo_</code>functions can be defined if necessary.</p><p><strong>Example</strong></p><p>```julia buf = Buffer(100000) @print<em>buffer</em>usage buf begin if true   A = alloc!(buf, 10, 10, 20) else   A = alloc!(buf, 10, 10, 30) end B = alloc!(buf, 10, 10, 10) if true   C = alloc!(buf, 10, 20) else   C = alloc!(buf, 10, 30) end rand!(B) rand!(C) An = neuralyze(A) @tensor An[i,j,k] = B[i,j,l] * C[l,k] drop!(buf, B, C) reset!(buf) end</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/usage.jl#L1-L37">source</a></section></article><h2 id="Internal-functions"><a class="docs-heading-anchor" href="#Internal-functions">Internal functions</a><a id="Internal-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers._buffer_usage-Tuple{Any, Any}" href="#Buffers._buffer_usage-Tuple{Any, Any}"><code>Buffers._buffer_usage</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_buffer_usage(ex, bufs)</code></pre><p>Allocations and deallocations together with corresponding <code>if</code>s  in expression <code>ex</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/usage.jl#L103-L108">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.current_buffer-Union{Tuple{ThreadsBuffer{T}}, Tuple{T}} where T" href="#Buffers.current_buffer-Union{Tuple{ThreadsBuffer{T}}, Tuple{T}} where T"><code>Buffers.current_buffer</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">current_buffer(buf::ThreadsBuffer{T})</code></pre><p>Return the buffer of the current thread.</p><p>If the buffer is not available, wait until it is released.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/threadsbuffer.jl#L69-L75">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.current_buffer_index-Tuple{ThreadsBuffer}" href="#Buffers.current_buffer_index-Tuple{ThreadsBuffer}"><code>Buffers.current_buffer_index</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">current_buffer_index(buf::ThreadsBuffer)</code></pre><p>Return the index of the buffer of the current thread.</p><p>If the buffer is not available, wait until it is released.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/threadsbuffer.jl#L51-L57">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.iscontiguous_tensor-Tuple{AbstractArray}" href="#Buffers.iscontiguous_tensor-Tuple{AbstractArray}"><code>Buffers.iscontiguous_tensor</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">iscontiguous_tensor(tensor::AbstractArray)</code></pre><p>Check if <code>tensor</code> is contiguous.</p><p>Return <code>true</code> if <code>tensor</code> is a <code>Vector</code> or a <code>SubArray</code> that is contiguous.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/Buffers.jl#L172-L178">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Buffers.release!-Tuple{ThreadsBuffer}" href="#Buffers.release!-Tuple{ThreadsBuffer}"><code>Buffers.release!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">release!(buf::ThreadsBuffer)</code></pre><p>Release buffer of the current thread.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fkfest/Buffers.jl/blob/a62abbc394291bfbcf5014eda90b84f1ddeb50fe/src/threadsbuffer.jl#L106-L110">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tensor_contractions/">« Tensor contractions</a><a class="docs-footer-nextpage" href="../release-notes/">Release notes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 12 December 2024 15:20">Thursday 12 December 2024</span>. Using Julia version 1.10.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
